# ADR-001: Python CLIテクノロジースタックの採用

## ステータス
**決定済み** - 2024-08-05

## コンテキスト
日報入力支援サービス「smart-nippo」のCLI版開発において、以下の要件を満たす技術スタックの選定が必要となった：

### 機能要件
- 基本的なCLI機能（引数解析、サブコマンド、ヘルプ生成）
- インタラクティブな日報入力（日付選択、プロジェクト選択等）
- 外部エディタ連携（VSCode、vim等での長文入力）
- クリップボード連携（出力内容の自動コピー）
- 美しいUI表示（テーブル、プログレスバー、色付き表示）

### 非機能要件
- クロスプラットフォーム対応（Windows、macOS、Linux、WSL）
- 高い開発効率
- 将来的なWeb版への展開を考慮
- AI/ML機能との連携

## 検討した選択肢

### 1. Python
**技術スタック**: Typer + Questionary + Rich + Click
- **CLI基本機能**: Typer（型ヒント統合、自動ヘルプ生成）
- **インタラクティブ機能**: Questionary（日付選択、自動補完）
- **UI表示**: Rich（美しいテーブル、プログレスバー）
- **エディタ連携**: Click.edit()（1行で実装可能）
- **クリップボード**: pyperclip（自動フォールバック機能）

### 2. Go
**技術スタック**: Cobra + Survey + 自作実装
- **配布**: 単一バイナリ（5-20MB）
- **OS互換性**: 最も問題が少ない
- **インタラクティブ機能**: Surveyで十分な機能

### 3. Node.js
**技術スタック**: Commander + Inquirer + 自作実装
- **Web開発者**: 慣れ親しんだ環境
- **インタラクティブ機能**: Inquirerで豊富な機能

### 4. Rust
**技術スタック**: Clap + Dialoguer + 自作実装
- **パフォーマンス**: 最高
- **バイナリサイズ**: 最小（2-10MB）
- **学習コスト**: 最も高い

## 決定
**Python（Typer + Questionary + Rich + Click）を採用する**

## 決定理由

### 1. 開発効率の最大化
- 全機能において最高評価のライブラリが利用可能
- エディタ連携が`click.edit()`の1行で実装可能
- インタラクティブ機能が最も豊富（日付ピッカー、自動補完等）
- AI/ML連携が最も容易

### 2. ユーザー体験の最適化
- Questionary + Richによる美しいインタラクティブUI
- 豊富なフォールバック機能（pyperclip）
- クロスプラットフォーム対応が最も成熟

### 3. 将来的な拡張性
- Web版バックエンド（FastAPI）との技術的整合性
- AI/ML機能の実装が最も容易
- 豊富なエコシステム

### 4. 技術的成熟度
- 各ライブラリが十分に成熟し、活発にメンテナンスされている
- 大規模なコミュニティサポート
- 豊富なドキュメントと学習リソース

## 機能別評価結果

| 機能 | Python | Go | Node.js | Rust |
|------|--------|-----|---------|------|
| CLI基本機能 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| インタラクティブ機能 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| エディタ連携 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| クリップボード連携 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 開発効率 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| AI/ML連携 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ | ⭐ |

## 実装方針

### 依存関係
```toml
[tool.poetry.dependencies]
python = "^3.11"
typer = "^0.9.0"
questionary = "^2.0.0"
rich = "^13.0.0"
click = "^8.1.0"
pyperclip = "^1.8.0"
```

### アーキテクチャ構成
```
smart-nippo/
├── src/
│   ├── cli/
│   │   ├── main.py          # Typer application
│   │   ├── commands/        # サブコマンド実装
│   │   ├── interactive/     # Questionary UI
│   │   └── utils/           # ユーティリティ
│   ├── core/                # ビジネスロジック
│   └── integrations/        # AI/ML連携
```

## 配布戦略
初期段階では以下の方法で配布：
1. **PyPI**: `pip install smart-nippo`
2. **pipx**: `pipx install smart-nippo`（推奨）
3. **将来的**: PyOxidizer/Nuitkaでのバイナリ化

## トレードオフ

### 採用により得られるもの
- 最高の開発効率
- 最高のユーザー体験
- 豊富な機能セット
- AI/ML連携の容易さ

### 採用により失うもの
- 配布の複雑さ（Python環境が必要）
- バイナリサイズの大きさ（50-100MB）
- 起動速度の遅さ

### リスク軽減策
- pipxの利用推奨により環境分離
- 将来的なGo製CLIクライアント + Python APIサーバーへの移行オプション
- バイナリ化による配布オプションの提供

## 関連ドキュメント
- [技術選定書](../技術選定.md)
- [CLI配布方法の比較検討](../CLI配布方法の比較検討.md)
- [クリップボード操作の実装比較](../クリップボード操作の実装比較.md)
- [CLIライブラリとインタラクティブ機能の比較](../CLIライブラリとインタラクティブ機能の比較.md)
- [エディタ連携の実装比較](../エディタ連携の実装比較.md)
- [機能別言語選択肢まとめ](../機能別言語選択肢まとめ.md)

## 今後の見直し予定
- フェーズ1完了時点（MVP完成時）での配布方法の再評価
- ユーザーフィードバックに基づく技術スタックの最適化検討
- Web版開発開始時点での技術的整合性の確認

---
**決定者**: 開発チーム  
**決定日**: 2024-08-05  
**次回見直し予定**: MVP完成時